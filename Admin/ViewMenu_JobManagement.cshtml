@using FujairahHR.Models;
@using System.Text.RegularExpressions;
@{
    var data_rs = (List<Dictionary<string, string>>)ViewBag.data_rs;
}

<style type="text/css">
    .parent_menu {
        display: block;
    }

    .menu_level {
        margin-right: 4px;
    }

    .mdi-arrow-right-box {
        font-size: 16px;
    }
</style>

<main class="admin-main">
    <!---->
    <!--site header begins-->
    <header class="admin-header">
        <a href="#" class="sidebar-toggle" data-toggleclass="sidebar-open" data-target="body"> </a>
        <nav class=" mr-auto my-auto">
            <ul class="nav align-items-center">
                <li class="nav-item"> <a class="nav-link  " data-target="#siteSearchModal" data-toggle="modal" href="#"> <i class=" mdi mdi-magnify mdi-24px align-middle"></i> </a> </li>
            </ul>
        </nav>
        <nav class=" ml-auto">
            <ul class="nav align-items-center">
                <li class="nav-item">
                    <div class="dropdown">
                        <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="mdi mdi-24px mdi-bell-outline"></i> <span class="notification-counter"></span> </a>
                        <div class="dropdown-menu notification-container dropdown-menu-right">
                            <div class="d-flex p-all-15 bg-white justify-content-between border-bottom "> <a href="#!" class="mdi mdi-18px mdi-settings text-muted"></a> <span class="h5 m-0">@CF.trans_code("en", "d192", "Notifications")</span> <a href="#!" class="mdi mdi-18px mdi-notification-clear-all text-muted"></a> </div>
                            <div class="notification-events bg-gray-300">
                                <div class="text-overline m-b-5">@CF.trans_code("en", "d193", "today")</div>
                                <a href="#" class="d-block m-b-10">
                                    <div class="card">
                                        <div class="card-body"> <i class="mdi mdi-circle text-success"></i> @CF.trans_code("en", "d194", "All systems operational.").</div>
                                    </div>
                                </a> <a href="#" class="d-block m-b-10">
                                    <div class="card">
                                        <div class="card-body"> <i class="mdi mdi-upload-multiple "></i> @CF.trans_code("en", "d195", "File upload successful.").</div>
                                    </div>
                                </a> <a href="#" class="d-block m-b-10">
                                    <div class="card">
                                        <div class="card-body"> <i class="mdi mdi-cancel text-danger"></i> @CF.trans_code("en", "d196", "Your holiday has been denied")  </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="nav-item dropdown ">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">
                        <div class="avatar avatar-sm avatar-online"> <span class="avatar-title rounded-circle bg-dark">V</span> </div>
                    </a>
                    <div class="dropdown-menu  dropdown-menu-right">
                        <a class="dropdown-item" href="#"> @CF.trans_code("en", "d219", "Add Account ") </a> <a class="dropdown-item" href="#">@CF.trans_code("en", "d197", "Reset Password")</a> <a class="dropdown-item" href="#"> @CF.trans_code("en", "d198", "Help") </a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="/Admin/AdminUser/logout"> @CF.trans_code("en", "d199", "Logout")</a>
                    </div>
                </li>
            </ul>
        </nav>
    </header>
    <!--site header ends -->
    <!---->
    <section class="admin-content">
        <div class="bg-dark">
            <div class="container">
                <div class="row p-b-60 p-t-60">

                    <div class="col-md-4 text-white p-b-30">
                        <div class="media">
                            <div class="avatar avatar mr-3">
                                <div class="avatar-title bg-success rounded-circle mdi mdi-newspaper">

                                </div>
                            </div>
                            <div class="media-body">
                                <h1>@CF.trans_code("en", "d264", "Menu") </h1>
                                <p class="opacity-75">
                                    @CF.trans_code("en", "d265", "View all menu.")
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3 text-center m-b-30 ml-auto">
                        <div class="rounded text-white bg-white-translucent">
                            <div class="p-all-15">
                                <div class="row">
                                    <div class="col-md-12 my-2 m-md-0">
                                        <div class="text-overline opacity-75"> @CF.trans_code("en", "d266", "Total Menu")  </div>
                                        <h3 class="m-0 text-success" id="total_records">@ViewBag.count</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-5 text-white">

                        <div style="text-align:right; padding-top:40px;">
                            <button style="width:110px" type="button" class="btn  m-b-30 ml-2 mr-2 btn-secondary" onclick="javascript:ajax_delete()">
                                <i class="mdi mdi-close"></i> @CF.trans_code("en", "d203", "Delete")
                            </button>
                            <button style="width:110px" type="button" class="btn  m-b-30 ml-2 mr-2 btn-warning" onclick="javascript:show_add_form()">
                                <i class="mdi mdi-plus"></i> @CF.trans_code("en", "d204", "New")
                            </button>
                            <button style="width:110px" type="button" class="btn  m-b-30 ml-2 mr-2 btn-info" onclick="javascript:show_edit_form()">
                                <i class="mdi mdi-border-color"></i>@CF.trans_code("en", "d205", "Edit")
                            </button>
                            <button style="width:110px" type="button" class="btn  m-b-30 ml-2 mr-2 btn-success" onclick="javascript:ajax_activate()">
                                <i class="mdi mdi-arrow-up"></i>@CF.trans_code("en", "d206", "Publish")
                            </button>
                            <button style="width:110px" type="button" class="btn  m-b-30 ml-2 mr-2 btn-danger" onclick="javascript:ajax_deactivate()">
                                <i class="mdi mdi-arrow-down"></i> @CF.trans_code("en", "d207", "Unpublish")
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        </div>


        <!--DT START-->
        <div class="container  pull-up">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive p-t-10">

                                <table id="tbl_listing" class="display" width="100%" cellspacing="0">
                                    <thead>
                                        <tr>
                                            <th class="text-center">@CF.trans_code("en", "d267", "Serial No") </th>
                                            <th>@CF.trans_code("en", "d268", "Menu [En]")</th>
                                            <th> @CF.trans_code("en", "d269", "Menu [Ar]")</th>
                                            <th> @CF.trans_code("en", "d270", "Link [En]")</th>
                                            <th>@CF.trans_code("en", "d271", "Link [Ar]")</th>
                                            <th class="text-center">@CF.trans_code("en", "d272", "Status")</th>
                                            <th class="text-center"><input type="checkbox" id="checkbox_row_all" class="checkbox_row_all" name="checkbox_row_all" />  </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-center"></td>
                                            <td class="text-center"></td>
                                            <td class="text-center"></td>
                                            <td class="text-center"></td>
                                            <td class="text-center"></td>
                                            <td class="text-center"></td>
                                            <td class="text-center"></td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <th class="text-center">@CF.trans_code("en", "d267", "Serial No") </th>
                                            <th>@CF.trans_code("en", "d268", "Menu [En]")</th>
                                            <th> @CF.trans_code("en", "d269", "Menu [Ar]")</th>
                                            <th> @CF.trans_code("en", "d270", "Link [En]")</th>
                                            <th>@CF.trans_code("en", "d271", "Link [Ar]")</th>
                                            <th class="text-center">@CF.trans_code("en", "d272", "Status")</th>
                                            <th class="text-center"> </th>
                                        </tr>
                                    </tfoot>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--DT END-->
    </section>
</main>

<!-- MODAL ADD START -->
<div id="modal_add" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="modal_add" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="card m-b-30">
                <div class="card-header">
                    <h5 class="m-b-0">
                        @CF.trans_code("en", "d273", "Menu Management")
                    </h5>
                    <p class="m-b-0 text-muted">
                        @CF.trans_code("en", "d274", "Add New Menu")
                    </p>
                </div>
                <div class="card-body ">
                    <form id="frm_add" name="frm_add">
                        <div class="form-group">
                            <label for="inputAddress">@CF.trans_code("en", "d268", "Menu [En]")</label>
                            <input type="text" class="form-control" id="menu_job_name_en" placeholder="@CF.trans_code("en", "d268", "Menu [En]")">
                        </div>

                        <div class="form-group">
                            <label for="inputZip">@CF.trans_code("en", "d269", "Menu [Ar]")</label>
                            <input type="text" class="form-control" id="menu_job_name_ar" placeholder="@CF.trans_code("en", "d269", "Menu [Ar]")">
                        </div>

                        <div class="form-group">
                            <label for="inputZip">@CF.trans_code("en", "d270", "Link [En]")</label>
                            <input type="text" class="form-control" id="menu_job_link_en" placeholder="@CF.trans_code("en", "d270", "Link [En]")">
                        </div>

                        <div class="form-group">
                            <label for="inputZip">@CF.trans_code("en", "d271", "Link [Ar]")</label>
                            <input type="text" class="form-control" id="menu_job_link_ar" placeholder="@CF.trans_code("en", "d271", "Link [Ar]")">
                        </div>

                        <div class="form-group">
                            <label for="inputZip">@CF.trans_code("en", "d275", "Parent")</label>
                            <select id="parent_id" class="form-control">
                                <option value="">@CF.trans_code("en", "df4", "Root")</option>
                                @{
                                    int serial_no = 0;
                                    string[] menu_arr = Regex.Split(ViewBag.menu_job_str_, ",");
                                    foreach (string menu_item in menu_arr)
                                    {
                                        if (string.IsNullOrEmpty(menu_item)) { continue; }

                                        string[] menu_item_arr = Regex.Split(menu_item, "~");
                                        string tbl_menu_job_id = menu_item_arr[0];
                                        string menu_job_name_en = menu_item_arr[1];
                                        string menu_job_name_ar = menu_item_arr[2];
                                        string level = menu_item_arr[3];
                                        string is_active = menu_item_arr[4];
                                        string sort_order = menu_item_arr[5];
                                        serial_no = serial_no + 1;

                                        string menu_levels_all_str = "";
                                        for (int j = 0; j < Convert.ToInt32(level); j++)
                                        {
                                            menu_levels_all_str = menu_levels_all_str + " |— ";
                                        }
                                        <option value="@tbl_menu_job_id">@menu_levels_all_str @menu_job_name_en</option>
                                    }
                                }
                            </select>
                        </div>


                    </form>
                    <div class="form-group">
                        <button class="btn btn-primary" onclick="ajax_create()">@CF.trans_code("en", "d276", "Submit")</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- MODAL ADD END -->
<!-- MODAL EDIT START -->
<div id="modal_edit" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="modal_edit" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="card m-b-30">
                <div class="card-header">
                    <h5 class="m-b-0">
                        @CF.trans_code("en", "d273", "Menu Management")
                    </h5>
                    <p class="m-b-0 text-muted">
                        @CF.trans_code("en", "d276", "Edit Menu")
                    </p>
                </div>
                <div class="card-body ">
                    <form id="frm_edit" name="frm_edit">
                        <div class="form-group">
                            <label for="inputAddress">@CF.trans_code("en", "d268", "Menu [En]")</label>
                            <input type="text" class="form-control" id="menu_job_name_en" placeholder="@CF.trans_code("en", "d268", "Menu [En]")">
                        </div>

                        <div class="form-group">
                            <label for="inputZip">@CF.trans_code("en", "d269", "Menu [Ar]")</label>
                            <input type="text" class="form-control" id="menu_job_name_ar" placeholder="@CF.trans_code("en", "d269", "Menu [Ar]")">
                        </div>

                        <div class="form-group">
                            <label for="inputZip">@CF.trans_code("en", "d270", "Link [En]")</label>
                            <input type="text" class="form-control" id="menu_job_link_en" placeholder="@CF.trans_code("en", "d270", "Link [En]")">
                        </div>

                        <div class="form-group">
                            <label for="inputZip">@CF.trans_code("en", "d271", "Link [Ar]")</label>
                            <input type="text" class="form-control" id="menu_job_link_ar" placeholder="@CF.trans_code("en", "d271", "Link [Ar]")">
                        </div>

                        <div class="form-group">
                            <label for="inputZip">@CF.trans_code("en", "d275", "Parent")</label>
                            <select id="parent_id" class="form-control">
                                <option value="">@CF.trans_code("en", "df4", "Root")</option>
                                @{
                                    serial_no = 0;
                                    menu_arr = Regex.Split(ViewBag.menu_job_str_, ",");
                                    foreach (string menu_item in menu_arr)
                                    {
                                        if (string.IsNullOrEmpty(menu_item)) { continue; }

                                        string[] menu_item_arr = Regex.Split(menu_item, "~");
                                        string tbl_menu_job_id = menu_item_arr[0];
                                        string menu_job_name_en = menu_item_arr[1];
                                        string menu_job_name_ar = menu_item_arr[2];
                                        string level = menu_item_arr[3];
                                        string is_active = menu_item_arr[4];
                                        string sort_order = menu_item_arr[5];
                                        serial_no = serial_no + 1;

                                        string menu_levels_all_str = "";
                                        for (int j = 0; j < Convert.ToInt32(level); j++)
                                        {
                                            menu_levels_all_str = menu_levels_all_str + " |— ";
                                        }
                                        <option value="@tbl_menu_job_id">@menu_levels_all_str @menu_job_name_en</option>
                                    }
                                }
                            </select>
                        </div>

                        <input type="hidden" name="tbl_menu_job_id_edit" id="tbl_menu_job_id_edit" value="" />
                    </form>
                    <div class="form-group">
                        <button class="btn btn-primary" onclick="ajax_save()">@CF.trans_code("en", "d276", "Submit")</button>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- MODAL EDIT END -->

<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.4/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.4/js/buttons.flash.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.colVis.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js"></script>

<script src="https://cdn.datatables.net/select/1.2.7/js/dataTables.select.min.js"></script>
<script src="https://cdn.datatables.net/rowreorder/1.2.5/js/dataTables.rowReorder.min.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.5.4/css/buttons.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/select/1.2.7/css/select.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/rowreorder/1.2.5/css/rowReorder.dataTables.min.css">

<script>
    //$(document).ready(function () {
    //    setTimeout(function () { $('select[name*=tbl_listing_length]').val(5); }, 500);
    //});
</script>

<script menu="javascript">

    var table = "";

    $(document).ready(function () {
        $('.checkbox_row_all').change(function () {
            if ($(this).is(":checked")) {
                $(".checkbox_row").each(function () {
                    var is_checked = $(this).prop("checked", true);
                    if (is_checked == true) {
                        record_id_str = record_id_str + $(this).val() + ",";
                    }
                });

            } else {
                $(".checkbox_row").each(function () {
                    var is_checked = $(this).prop("checked", false);
                    if (is_checked == true) {
                        record_id_str = record_id_str + $(this).val() + ",";
                    }
                });
            }
        });

        $('input[type="checkbox"]').on('click', function () {
        });

    });

    var exportOptions = {
        columns: ':visible:not(.not-exported)',
        rows: '.selected'
    }

    var table = "";
    $(document).ready(function () {

        table = $('#tbl_listing').DataTable({
            dom: 'lBfrtip',
            ajax: '/admin/Menu_Job/get_all_menu_job_data_table/',
            "pageLength": 50,
            "bSort": true,
            "bFilter": true,
            'scrollX': true,
            "bPaginate": true,
            "bFilter": true,
            "bLengthChange": true,
            autoFilter: true,
            "oLanguage": {
                "sLengthMenu": "  _MENU_  "
            },
            columns: [
                { data: 'readingOrder', className: 'reorder' },
                { data: 'menu_job_name_en' },
                { data: 'menu_job_name_ar' },
                { data: 'menu_job_link_en' },
                { data: 'menu_job_link_ar' },
                { data: 'status' },
                { data: 'checkbox' },
            ],
            columnDefs: [
                { orderable: true, targets: [1, 2, 3] },
                {
                    "targets": 0,
                    "className": "text-center",
                    "width": "8%"
                },
                {
                    "targets":5,
                    "className": "text-center",
                    "width": "8%"
                },
                {
                    "targets": 6,
                    "className": "text-center",
                    "width": "8%"
                },
            ],

            select: true,
            rowReorder: {
                dataSrc: 'readingOrder',

            }, buttons: [
                'colvis',
                'selectAll',
                'selectNone',
                {
                    extend: 'collection',
                    text: 'Export Selected',
                    buttons: [
                        {
                            extend: 'copy',
                            exportOptions: exportOptions
                        },
                        {
                            extend: 'csv',
                            exportOptions: exportOptions
                        },
                        {
                            extend: 'print',
                            exportOptions: exportOptions
                        }
                    ]
                }
            ],
        });

        $('#tbl_listing').on('row-reorder.dt', function (e, details, edit) {
            var sort_order_max = 0;
            var sort_id_str = "";
            $(".checkbox_row").each(function () {
                var sort_order = $(this).attr("data-sortorder");
                if (sort_order > sort_order_max) { sort_order_max = sort_order; }
                var elem_id = $(this).attr("data-id");
                sort_id_str = sort_id_str + elem_id + ",";
            });

            ajax_set_sort_order(sort_id_str, sort_order_max);
        });



    });

    $(document).ready(function () {
        $('#tbl_listing').on('click', 'tr', function () {
            $(this).toggleClass("selected");
        });

        $('#tbl_listing').on('click', 'input[type="checkbox"]', function (event) {
            event.stopPropagation()
        });

        $('#tbl_listing').on('click', 'input[type="button"]', function (event) {
            event.stopPropagation()
            //alert($(this).parent().find("span").html());

            var current_menu_id = $(this).parent().find("span").html();
            var parent_menu_id = $(this).parent().find("span").html();
            //alert($(this).closest("tr").prev().find("span.parent_menu").html());

            //alert($(this).closest("tr").find("td:nth-child(2)").html());
            var class_name = $(this).attr("class");
            if (class_name == "menu_move_right") {
                $(this).closest("tr").find("td:nth-child(2)").find("span.menu_levels").append("<span class='menu_level'><span class='mdi mdi-arrow-right-box'></span></span>");
            } else if (class_name == "menu_move_left") {
                $(this).closest("tr").find("td:nth-child(2)").find("span.menu_levels").find("span.menu_level:nth-child(1)").remove();
            }
        });
    });

    function show_add_form() {
        load_menu_job_ddm_ajax();
        $("#modal_add").modal('show');
    }

    function show_edit_form() {

        load_menu_job_ddm_ajax();

        var record_id = "", flg = 0;
        $(".checkbox_row").each(function () {
            var is_checked = $(this).prop("checked");
            if (is_checked == true && flg == 0) {
                record_id = $(this).val();
                flg = 1;
            }
        });

        if (record_id == "") {
            my_alert("@CF.trans_code("en", "d445", "@CF.trans_code("en", "c97", "Please select at least one record to proceed.")")");
            return;
        }
        $.ajax({
            type: "POST",
            url: "/admin/Menu_Job/edit",
            data: {
                record_id: record_id,
                is_ajax: true
            },
            success: function (data) {
                if (data.code == "SE") {
                            my_alert("@CF.trans_code("en", "d443", "@CF.trans_code("en", "c109", "There was an error processing your request. Please try again.")")");
                    return;
                }

                var tbl_menu_job_id = data.obj.tbl_menu_job_id;
                var menu_job_name_en = data.obj.menu_job_name_en;
                var menu_job_name_ar = data.obj.menu_job_name_ar;
                var menu_alias = data.obj.menu_alias;
                var menu_job_link_en = data.obj.menu_job_link_en;
                var menu_job_link_ar = data.obj.menu_job_link_ar;
                var is_published = data.obj.is_published;
                var menu_location = data.obj.menu_location;
                var parent_id = data.obj.parent_id;
                var added_date = data.obj.added_date;
                var is_active = data.obj.is_active;
                var sort_order = data.obj.sort_order;

                $("#tbl_menu_job_id_edit").val(tbl_menu_job_id);
                $("#frm_edit #menu_job_name_en").val(menu_job_name_en);
                $("#frm_edit #menu_job_name_ar").val(menu_job_name_ar);
                $("#frm_edit #menu_alias").val(menu_alias);
                $("#frm_edit #menu_job_link_en").val(menu_job_link_en);
                $("#frm_edit #menu_job_link_ar").val(menu_job_link_ar);
                $("#frm_edit #is_published").val(is_published);
                $("#frm_edit #menu_location").val(menu_location);
                //if (is_published == "Y") { $("#frm_edit #is_published").prop("checked", true); } else { $("#frm_edit #is_published").prop("checked", false);}
                $("#frm_edit #parent_id").val(parent_id);

                $("#modal_edit").modal("show");
            },
            error: function () {
            },
            complete: function () {
            }
        });
    }

    function ajax_activate() {

        var record_id_str = "";
        $(".checkbox_row").each(function () {
            var is_checked = $(this).prop("checked");
            if (is_checked == true) {
                record_id_str = record_id_str + $(this).val() + ",";
            }
        });

        if (record_id_str == "") {
            my_alert("@CF.trans_code("en", "d445", "@CF.trans_code("en", "c97", "Please select at least one record to proceed.")")");
            return;
        }

        swal({
            title: "@CF.trans_code("en", "d89", "Message")",
            text: "@CF.trans_code("en", "d90", "Are you sure?")",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "@CF.trans_code("en", "d91", "Yes")",
            closeOnConfirm: true
        },
            function () {

                preloader("show", "");

                var url = "/admin/Menu_Job/Activate";
                $.ajax({
                    type: "POST",
                    url: url,
                    dataType: "JSON",
                    data: {
                        record_id_str: record_id_str,
                    },
                    success: function (data) {
                        preloader("hide", "");
                        if (data.code == "SE") {
                                        my_alert("@CF.trans_code("en", "d454", "@CF.trans_code("en", "c98", "Your session is invalid or it has expired. Kindly log in again.")")");
                        } else if (data.code == "Y") {

                            $(".checkbox_row").each(function () {
                                var is_checked = $(this).prop("checked");
                                if (is_checked == true) {
                                    $("#status_row_" + $(this).val()).removeClass("status_row_unpublished").addClass("status_row_published");
                                    $(this).prop("checked", false);
                                }
                            });

                            my_alert("@CF.trans_code("en", "d442", "@CF.trans_code("en", "c107", "Information has been saved successfully.")")");

                        } else {
                            my_alert("@CF.trans_code("en", "d443", "@CF.trans_code("en", "c109", "There was an error processing your request. Please try again.")")");
                        }
                    },
                    error: function () {
                            my_alert("@CF.trans_code("en", "d443", "@CF.trans_code("en", "c109", "There was an error processing your request. Please try again.")")");
                        preloader("hide", "");
                    }
                });
            });

        return;
    }

    function ajax_deactivate() {

        var record_id_str = "";
        $(".checkbox_row").each(function () {
            var is_checked = $(this).prop("checked");
            if (is_checked == true) {
                record_id_str = record_id_str + $(this).val() + ",";
            }
        });

        if (record_id_str == "") {
            my_alert("@CF.trans_code("en", "d445", "@CF.trans_code("en", "c97", "Please select at least one record to proceed.")")");
            return;
        }

        swal({
            title: "@CF.trans_code("en", "d89", "Message")",
            text: "@CF.trans_code("en", "d90", "Are you sure?")",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "@CF.trans_code("en", "d91", "Yes")",
            closeOnConfirm: true
        },
            function () {
                preloader("show", "");

                var url = "/admin/Menu_Job/Deactivate";
                $.ajax({
                    type: "POST",
                    url: url,
                    dataType: "JSON",
                    data: {
                        record_id_str: record_id_str,
                    },
                    success: function (data) {
                        preloader("hide", "");
                        if (data.code == "SE") {
                                        my_alert("@CF.trans_code("en", "d454", "@CF.trans_code("en", "c98", "Your session is invalid or it has expired. Kindly log in again.")")");
                        } else if (data.code == "Y") {
                            $(".checkbox_row").each(function () {
                                var is_checked = $(this).prop("checked");
                                if (is_checked == true) {
                                    $("#status_row_" + $(this).val()).removeClass("status_row_published").addClass("status_row_unpublished");
                                    $(this).prop("checked", false);
                                }
                            });

                            my_alert("@CF.trans_code("en", "d442", "@CF.trans_code("en", "c107", "Information has been saved successfully.")")");

                        } else {
                            my_alert("@CF.trans_code("en", "d443", "@CF.trans_code("en", "c109", "There was an error processing your request. Please try again.")")");
                        }
                    },
                    error: function () {
                            my_alert("@CF.trans_code("en", "d443", "@CF.trans_code("en", "c109", "There was an error processing your request. Please try again.")")");
                        preloader("hide", "");
                    }
                });
            });

        return;
    }

    function ajax_delete() {

        var record_id_str = "";
        $(".checkbox_row").each(function () {
            var is_checked = $(this).prop("checked");
            if (is_checked == true) {
                record_id_str = record_id_str + $(this).val() + ",";
            }
        });

        if (record_id_str == "") {
            my_alert("@CF.trans_code("en", "d445", "@CF.trans_code("en", "c97", "Please select at least one record to proceed.")")");
            return;
        }

        swal({
            title: "@CF.trans_code("en", "d89", "Message")",
            text: "@CF.trans_code("en", "d90", "Are you sure?")",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "@CF.trans_code("en", "d91", "Yes")",
            closeOnConfirm: true
        },
            function () {
                preloader("show", "");

                var url = "/admin/Menu_Job/Delete";
                $.ajax({
                    type: "POST",
                    url: url,
                    dataType: "JSON",
                    data: {
                        record_id_str: record_id_str,
                    },
                    success: function (data) {
                        preloader("hide", "");
                        if (data.code == "SE") {
                                        my_alert("@CF.trans_code("en", "d454", "@CF.trans_code("en", "c98", "Your session is invalid or it has expired. Kindly log in again.")")");
                        } else if (data.code == "Y") {
                            deselect_rows();
                            table.ajax.reload();
                            $("#total_records").html(data.total_records);
                            my_alert("@CF.trans_code("en", "d442", "@CF.trans_code("en", "c107", "Information has been saved successfully.")")");
                        } else {
                            my_alert("@CF.trans_code("en", "d443", "@CF.trans_code("en", "c109", "There was an error processing your request. Please try again.")")");
                        }
                    },
                    error: function () {
                            my_alert("@CF.trans_code("en", "d443", "@CF.trans_code("en", "c109", "There was an error processing your request. Please try again.")")");
                        preloader("hide", "");
                    }
                });
            });

        return;
    }

    function ajax_create() {
        var str = "";
        var regExp = / /g;

        var menu_job_name_en = $("#frm_add #menu_job_name_en").val();
        var menu_job_name_ar = $("#frm_add #menu_job_name_ar").val();
        var menu_job_link_en = $("#frm_add #menu_job_link_en").val();
        var menu_job_link_ar = $("#frm_add #menu_job_link_ar").val();
        var parent_id = $("#frm_add #parent_id").val();

        str = menu_job_name_en;
        str = str.replace(regExp, '');
        if (str.length <= 0) {
            my_alert("@CF.trans_code("en", "d467", "Menu [En] is blank. Please enter Menu [En].")");
            return false;
        }

        str = strip_html(menu_job_name_ar);
        str = str.replace(regExp, '');
        if (str.length <= 0) {
            my_alert("@CF.trans_code("en", "d468", "Menu [Ar] is blank. Please enter Menu [Ar].")");
            return false;
        }

        $.ajax({
            type: "POST",
            url: "/admin/Menu_Job/create",
            data: {
                menu_job_name_en: menu_job_name_en,
                menu_job_name_ar: menu_job_name_ar,
                menu_job_link_en: menu_job_link_en,
                menu_job_link_ar: menu_job_link_ar,
                parent_id: parent_id,
                is_ajax: true
            },
            success: function (data) {

                if (data.code == "Y") {
                    $("#modal_add").modal('hide');
                    $("#total_records").html(data.total_records);
                    deselect_rows();
                    table.ajax.reload();
                            my_alert("@CF.trans_code("en", "d442", "@CF.trans_code("en", "c107", "Information has been saved successfully.")")");

                } else {
                            my_alert("@CF.trans_code("en", "d443", "@CF.trans_code("en", "c109", "There was an error processing your request. Please try again.")")");
         }

                $('#frm_add #menu_job_name_en').val("");
                $('#frm_add #menu_job_name_ar').val("");
                $('#frm_add #menu_job_link_en').val("");
                $('#frm_add #menu_job_link_ar').val("");
                $('#frm_add #parent_id').val("");
            },
            error: function () {
            },
            complete: function () {
            }
        });
    }

    function ajax_save() {
        var str = "";
        var regExp = / /g;

        var tbl_menu_job_id = $("#tbl_menu_job_id_edit").val();
        var menu_job_name_en = $("#frm_edit #menu_job_name_en").val();
        var menu_job_name_ar = $("#frm_edit #menu_job_name_ar").val();
        var menu_job_link_en = $("#frm_edit #menu_job_link_en").val();
        var menu_job_link_ar = $("#frm_edit #menu_job_link_ar").val();
        var parent_id = $("#frm_edit #parent_id").val();

        str = menu_job_name_en;
        str = str.replace(regExp, '');
        if (str.length <= 0) {
            my_alert("@CF.trans_code("en", "d467", "Menu [En] is blank. Please enter Menu [En].")");
            return false;
        }

        str = strip_html(menu_job_name_ar);
        str = str.replace(regExp, '');
        if (str.length <= 0) {
            my_alert("@CF.trans_code("en", "d468", "Menu [Ar] is blank. Please enter Menu [Ar].")");
            return false;
        }

        if (tbl_menu_job_id == parent_id && parent_id!="") {
            my_alert("@CF.trans_code("en", "d469", "Parent menu cannot be self assigned to itself.")");
            return false;
        }

        $.ajax({
            type: "POST",
            url: "/admin/Menu_Job/save",
            data: {
                tbl_menu_job_id: tbl_menu_job_id,
                menu_job_name_en: menu_job_name_en,
                menu_job_name_ar: menu_job_name_ar,
                menu_job_link_en: menu_job_link_en,
                menu_job_link_ar: menu_job_link_ar,
                parent_id: parent_id,
                is_ajax: true
            },
            success: function (data) {

                if (data.code == "Y") {
                    $("#modal_edit").modal('hide');
                    $("#total_records").html(data.total_records);
                    deselect_rows();
                    table.ajax.reload();
                            my_alert("@CF.trans_code("en", "d442", "@CF.trans_code("en", "c107", "Information has been saved successfully.")")");

                } else {
                            my_alert("@CF.trans_code("en", "d443", "@CF.trans_code("en", "c109", "There was an error processing your request. Please try again.")")");
                }

                $('#menu_job_name_en').val("");
                $('#menu_job_name_en').val("");
            },
            error: function () {
            },
            complete: function () {
            }
        });
    }


    function ajax_set_sort_order(sort_id_str, sort_order_max) {

        $.ajax({
            type: "POST",
            url: "/admin/Menu_Job/set_sort_order",
            data: {
                sort_id_str: sort_id_str,
                sort_order_max: sort_order_max,
                is_ajax: true
            },
            success: function (data) {
                //if(data.code == "Y") {
                //    my_alert("@CF.trans_code("en", "c107", "Information has been saved successfully.")", "green");
                //} else {
                //    my_alert("@CF.trans_code("en", "c109", "There was an error processing your request. Please try again.")");
                //}
            },
            error: function () {
            },
            complete: function () {
            }
        });
    }

    function deselect_rows() {
        table.rows({ selected: true }).deselect();
    }

    function load_menu_job_ddm_ajax() {
        $.ajax({
            type: "POST",
            url: "/admin/Menu_Job/menu_job_ddm_ajax",
            dataType: "HTML",
            data: {
            },
            success: function (data) {
                preloader("hide", "");

                $("#frm_add #parent_id").html(data);
                $("#frm_edit #parent_id").html(data);
            },
            error: function (err) {
                //my_alert("@CF.trans_code("en", "c109", "There was an error processing your request. Please try again.")", "red");
                preloader("hide", "");
            }
        });
    }

</script>

<style type="text/css">
    .status_row {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        margin: 0 auto;
    }

    .status_row_published {
        background-color: #00A47C;
    }

    .status_row_unpublished {
        background-color: #EF2E30;
    }

    .mdi-drag-variant {
        cursor: move;
    }

    .ml-2, .mx-2 {
        margin-left: 0px !important;
        margin-right: 5px !important;
    }
</style>


<script menu="javascript">

</script>
<script menu="javascript">
    function strip_html(html) {
        var tmp = document.createElement("DIV");
        tmp.innerHTML = html;
        return $.trim(tmp.textContent) || $.trim(tmp.innerText) || "";
    }
</script>


